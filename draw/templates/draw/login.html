<!DOCTYPE html>

{% load static %}
<html style="font-size: 16px;">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <title>login</title>
    <link rel="shortcut icon" href="{% static 'draw/images/favicon.jpeg' %}">
    <link rel="stylesheet" href="{% static 'draw/css/nicepage.css' %}" media="screen">
    <link rel="stylesheet" href="{% static 'draw/css/login.css' %}" media="screen">

    <meta name="generator" content="Nicepage 4.11.3, nicepage.com">
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">


    <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "AlphaRaffle",
            "logo": "images/logo3.jpeg"
        }
    </script>
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="login">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
</head>

<body class="u-body u-xl-mode">

    <!-- 헤더 -->
    {% include 'draw/header.html' %}

    <!-- 본문 -->
    <section class="u-clearfix u-section-1 wrapper" id="sec-a597">
        <div class="u-clearfix u-sheet u-sheet-1">
            <div class="u-align-center u-form u-login-control u-form-1">

                <!-- 로그인/회원가입 탭 -->
                <div class="account_tab">
                    <div class="signin_tab active">로그인</div>
                    <div class="signup_tab disable">회원가입</div>
                </div>

                <!-- 에러 메세지 -->
                <div class="message_box">
                    <p class="danger hidden" id=""></p>
                </div>


                <!-- 회원가입 -->
                {% csrf_token %}
                <div class="signup_box" style="display: none;">
                    <form id="signup_form" action="{% url 'draw:member_insert' %}" method="POST" class="u-clearfix u-form-spacing-10 u-form-vertical u-inner-form" source="custom" name="form" style="padding: 10px;">

                        <input type="hidden" id="idcheck" value="0"/>
                        <div class="u-form-email u-form-group u-form-group-1">
                            <label for="email-6642" class="u-label u-label-1">이메일</label>
                             <a onclick="checkId();" class="u-border-none u-btn-20 u-btn-round u-btn-submit u-button-style u-grey-80 u-hover-grey-60 u-radius-50 overlap">중복확인<br>
                            </a>
                            <input type="email" placeholder="이메일을 입력하세요." id="member_id" name="member_id" class="u-border-3 u-border-grey-80 u-input u-input-rectangle u-radius-50 u-white" required="">
                        </div>
                        <div class="u-form-group u-form-group-2">
                            <label for="text-759f" class="u-label u-label-2">비밀번호</label>
                            <input type="password" placeholder="비밀번호를 입력하세요." id="member_pwd" name="member_pwd" class="u-border-3 u-border-grey-80 u-input u-input-rectangle u-radius-50 u-white" required="required">
                        </div>
                        <div class="u-form-group u-form-group-2">
                            <label for="text-759f" class="u-label u-label-2">비밀번호 확인</label>
                            <input type="password" placeholder="비밀번호를 입력하세요." id="member_pwd2" name="member_pwd2" class="u-border-3 u-border-grey-80 u-input u-input-rectangle u-radius-50 u-white" required="required">
                        </div>
                        <div class="u-form-group u-form-name u-form-group-3">
                            <label for="name-383a" class="u-label u-label-3">이름</label>
                            <input type="text" placeholder="이름을 입력하세요." id="member_realname" name="member_realname" class="u-border-3 u-border-grey-80 u-input u-input-rectangle u-radius-50 u-white" required="">
                        </div>
                        <div class="u-form-group u-form-group-4">
                            <label for="text-a28f" class="u-label u-label-4">닉네임</label>
                            <input type="text" placeholder="닉네임을 입력하세요." id="member_nickname" name="member_nickname" class="u-border-3 u-border-grey-80 u-input u-input-rectangle u-radius-50 u-white" required="required" maxlength="15">
                        </div>
                        <div class="u-form-group u-form-phone u-form-group-5">
                            <label for="phone-1dfe" class="u-label u-label-5">핸드폰번호</label>
                            <input type="tel" pattern="\+?\d{0,3}[\s\(\-]?([0-9]{2,3})[\s\)\-]?([\s\-]?)([0-9]{3})[\s\-]?([0-9]{2})[\s\-]?([0-9]{2})" placeholder="핸드폰번호를 입력하세요. ex)01012345678" id="member_phonenumber" name="member_phonenumber" class="u-border-3 u-border-grey-80 u-input u-input-rectangle u-radius-50 u-white" required="">
                        </div>
                        <!--
                        <div class="u-form-group u-form-select u-form-group-6">
                            <label for="select-8282" class="u-label u-label-6">신발 사이즈</label>
                            <div class="u-form-select-wrapper">
                                <select id="select-8282" name="select" class="u-border-3 u-border-grey-80 u-input u-input-rectangle u-radius-50 u-white">
                                    <option value="220">220</option>
                                    <option value="225">225</option>
                                    <option value="230">230</option>
                                    <option value="235">235</option>
                                    <option value="240">240</option>
                                    <option value="245">245</option>
                                    <option value="250">250</option>
                                    <option value="255">255</option>
                                    <option value="260">260</option>
                                    <option value="265">265</option>
                                    <option value="270">270</option>
                                    <option value="275">275</option>
                                    <option value="280">280</option>
                                    <option value="285">285</option>
                                    <option value="290">290</option>
                                    <option value="295">295</option>
                                    <option value="300">300</option>
                                </select>
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="12" version="1" class="u-caret">
                                    <path fill="currentColor" d="M4 8L0 4h8z"></path>
                                </svg>
                            </div>
                        </div>
                    -->
                        <div class="u-form-group u-form-group-7">
                            <label for="text-52d5" class="u-label u-label-7">나이키 ID</label>
                            <input type="text" placeholder="AlphaRaffle 서비스 이용 시 선택사항입니다." id="member_nikeid" name="member_nikeid" class="u-border-3 u-border-grey-80 u-input u-input-rectangle u-radius-50 u-white">
                        </div>
                        <div class="u-form-group u-form-group-8">
                            <label for="text-abb3" class="u-label u-label-8">생년월일</label>
                            <input type="text" placeholder="AlphaRaffle 서비스 이용 시 선택사항입니다." id="member_birth" name="member_birth" class="u-border-3 u-border-grey-80 u-input u-input-rectangle u-radius-50 u-white">
                        </div>
                        <div class="u-form-checkbox u-form-group u-label-top u-form-group-9">
                            <input type="checkbox" id="warrantcheck" name="warrantcheck" value="On">
                            <label for="warrantcheck" class="u-text-grey-80">&nbsp;(필수) 본인은 만 14세 이상이며 이메일 주소 수집에 동의합니다.</label>
                        </div>
                        <div class="u-align-left u-form-group u-form-submit">
                            <a onclick="registerMember();" class="u-border-none u-btn u-btn-round u-btn-submit u-button-style u-grey-80 u-hover-grey-60 u-radius-50 u-btn-1">회원가입<br>
                            </a>
                            <input type="submit" value="submit" class="u-form-control-hidden" id="signup_btn">
                        </div>
                        <input type="hidden" value="" name="recaptchaResponse">
                    </form>
                </div>

                <!-- 로그인 -->

                <div class="signin_box">
                    <form id="signin_form" action="{% url 'draw:member_login' %}" method="POST" class="u-clearfix u-form-custom-backend u-form-spacing-10 u-form-vertical u-inner-form" source="custom" name="form" style="padding: 10px;">

                        {% csrf_token %}
                        <div class="u-form-group u-form-name u-label-top">
                            <label for="username-a30d" class="u-label u-spacing-0 u-text-grey-80 u-label-1">이메일 *</label>
                            <input type="text" placeholder="이메일을 입력하세요." id="member_loginid" name="member_loginid" class="u-border-2 u-border-grey-80 u-input u-input-rectangle u-radius-50 u-input-1" required="">
                        </div>
                        <div class="u-form-group u-form-password u-label-top">
                            <label for="password-a30d" class="u-label u-spacing-0 u-text-grey-80 u-label-2">비밀번호 *</label>
                            <input type="password" placeholder="비밀번호를 입력하세요." id="member_loginpwd" name="member_loginpwd" class="u-border-2 u-border-grey-80 u-input u-input-rectangle u-radius-50 u-input-2" required="">
                        </div>
                        <div class="u-form-checkbox u-form-group u-label-top">
                            <input type="checkbox" id="checkbox-a30d" name="remember" value="On">
                            <label for="checkbox-a30d" class="u-label u-spacing-0 u-text-grey-80 u-label-3">이메일 기억하기</label>
                        </div>
                        <div class="error_box" style="width: 550px; text-align: center; display: none;">
                            <p class="error_message" style="margin-top: 0px; color: red;"></p>
                        </div>
                        
                        <div class="u-align-left u-form-group u-form-submit u-label-top">
                            <input type="submit" value="submit" class="u-form-control-hidden">
                            <a onclick="loginCheck();" class="u-border-none u-btn u-btn-round u-btn-submit u-button-style u-grey-80 u-hover-grey-60 u-radius-50 u-btn-1">로그인<br>
                            </a>
                        </div>
                        <input type="hidden" value="" name="recaptchaResponse">
                    </form>
                </div>
                <br><br>
            </div>

        </div>
    </section>

    <!-- 풋터 -->
    {% include 'draw/footer.html' %}

    <script class="u-script" type="text/javascript" src="{% static 'draw/js/jquery.js' %}" defer=""></script>
    <script class="u-script" type="text/javascript" src="{% static 'draw/js/nicepage.js' %}" defer=""></script>
    <script type="text/javascript" src="{% static 'draw/js/sha1.js' %}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script>
        $(document).ready(function() {
            $('.signin_tab').on('click', function() {
                $('.error_box').hide();
                $('#error_message').addClass('hidden');
                $('.login_error_message').addClass('hidden');
                $(this).addClass('active');
                $(this).removeClass('disable');
                $('.signup_tab').addClass('disable');
                $('.signup_tab').removeClass('active');
                $('.signin_box').show();
                $('.signup_box').hide();
            });
            $('.signup_tab').on('click', function() {
                $('.error_box').hide();
                $('#error_message').addClass('hidden');
                $('.login_error_message').addClass('hidden');
                $(this).addClass('active');
                $(this).removeClass('disable');
                $('.signin_tab').addClass('disable');
                $('.signin_tab').removeClass('active');
                $('.signin_box').hide();
                $('.signup_box').show();
            });

        });
        function validateEmail(email) {
        var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
        return re.test(email);
        }

        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        var csrftoken = getCookie('csrftoken');

        var xhr;

        function registerMember() {

            memberid = document.getElementById("member_id").value;
            if(memberid == "") {
                Swal.fire({
                  icon: 'error',
                  title: '아이디를 입력하세요.',
                  confirmButtonColor: '#000000',
                  timer: 2000,
                  timerProgressBar: true
                })
                document.getElementById("member_id").focus();
                return false;
            }

            memberpwd = document.getElementById("member_pwd").value;
            if(memberpwd == "") {
                document.getElementById("member_pwd").focus();
                return false;
            }

            memberpwd2 = document.getElementById("member_pwd2").value;
            if(memberpwd2 == "") {
                document.getElementById("member_pwd2").focus();
                return false;
            }

            if(memberpwd != memberpwd2) {
                Swal.fire({
                  icon: 'error',
                  title: '비밀번호 확인이 틀립니다.',
                  confirmButtonColor: '#000000',
                  timer: 2000,
                  timerProgressBar: true
                })
                document.getElementById("member_pwd2").focus();
                return false;
            }

            pwdencrypted = hex_sha1(memberpwd);

            wflag = document.getElementById("warrantcheck").checked;
            if(wflag == false) {
                Swal.fire({
                  icon: 'error',
                  title: '약관에 동의해주세요.',
                  confirmButtonColor: '#000000',
                  timer: 2000,
                  timerProgressBar: true
                })
                return false;
            }
            
            idchk = document.getElementById("idcheck").value;
            if(idchk != "1") {
                Swal.fire({
                  icon: 'error',
                  title: '아이디 중복확인을 하세요.',
                  confirmButtonColor: '#000000',
                  timer: 2000,
                  timerProgressBar: true
                })
                return false;
            }

            memberrealname = document.getElementById("member_realname").value;
            membernickname = document.getElementById("member_nickname").value;
            memberbirth = document.getElementById("member_birth").value;
            membernikeid = document.getElementById("member_nikeid").value;
            memberphonenumber = document.getElementById("member_phonenumber").value;

            //alert(strurl);
            //return false;
            var strurl = "/member_insert?&member_id=" + memberid + "&member_pwd=" + pwdencrypted + "&member_realname=" + memberrealname + "&member_nickname=" + membernickname + "&member_birth=" + memberbirth + "&member_nikeid=" + membernikeid + "&member_phonenumber=" + memberphonenumber;


            xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4) {
                    var data = xhr.responseText;

                    var obj = JSON.parse(data);
                    alert(obj.result_msg);
                    if(obj.flag == "1"){
                        location.href = "/";
                    }
                }
            };
            // Swal.fire({
            //   icon: 'success',
            //   title: '회원가입 성공',
            //   confirmButtonColor: '#000000',
            //   timer: 2000,
            //   timerProgressBar: true
            // })
            xhr.open("POST", "/member_insert");
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
            // xhr.send(null);
        }

        function checkId() {
            memberid = document.getElementById("member_id").value;
            regExp = /^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*.[a-zA-Z]{2,3}$/i;
            if (memberid.match(regExp) == null) {
                Swal.fire({
                  icon: 'error',
                  title: '이메일 형식이 아닙니다.',
                  confirmButtonColor: '#000000',
                  timer: 2000,
                  timerProgressBar: true
                })
                document.getElementById("member_id").focus();
                return false;
            }
            if(memberid == "") {
                Swal.fire({
                  icon: 'error',
                  title: '아이디가 비어있습니다.',
                  confirmButtonColor: '#000000',
                  timer: 2000,
                  timerProgressBar: true
                })
                document.getElementById("member_id").focus();
                return false;
            }

            var strurl = "/member_idcheck?member_id=" + memberid;
            //alert(strurl);
            //return false;

            xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4) {
                    var data = xhr.responseText;

                    var obj = JSON.parse(data);
                    if(obj.flag == "1") {
                        Swal.fire({
                          icon: 'error',
                          title: obj.result_msg,
                          confirmButtonColor: '#000000',
                          timer: 2000,
                          timerProgressBar: true
                        })
                        document.getElementById("member_id").focus();
                    }
                    else {
                        Swal.fire({
                          icon: 'success',
                          title: obj.result_msg,
                          confirmButtonColor: '#000000',
                          timer: 2000,
                          timerProgressBar: true
                        })
                        document.getElementById("idcheck").value = "1";
                        document.getElementById("member_id").readOnly = true; 
                    }
                }
            };
            xhr.open("POST",strurl);
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
            xhr.send(null);
        }

        function loginCheck(bno) {

            memberid = document.getElementById("member_loginid").value;
            if(memberid == "") {
                $('.error_box').show();
                $('.error_message').html('이메일을 입력하세요.');
                document.getElementById("member_loginid").focus();
                return false;
            }

            memberpwd = document.getElementById("member_loginpwd").value;
            if(memberpwd == "") {
                $('.error_box').show();
                $('.error_message').html('비밀번호를 입력하세요.');
                document.getElementById("member_loginpwd").focus();
                return false;
            }
            pwdencrypted = hex_sha1(memberpwd);

            var strurl = "/member_login?member_id=" + memberid + "&member_pwd=" + pwdencrypted;
            //alert(strurl);
            //return break;

            xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4) {
                    var data = xhr.responseText;
                    print(data);
                    alert(data);

                    var obj = JSON.parse(data);
                    // print(obj)
                    print(obj.flag);
                    if(obj.flag == "0"){
                        alert(obj.result_msg);
                        location.href = "/";
                    }
                    else {
                        Swal.fire({
                          icon: 'error',
                          title: obj.result_msg,
                          confirmButtonColor: '#000000',
                          timer: 2000,
                          timerProgressBar: true
                        })
                        document.getElementById("member_id").focus();
                        return false;
                    }
                }
            };
            xhr.open("POST", strurl);
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
            xhr.send(null);
        }
    </script>
</body>

</html>